@model ABankAdmin.ViewModels.OtherBankReconSearchVM
@{
    ViewBag.Title = "OtherBankRecon";
}
<link href="~/Content/TabStyle.css" rel="stylesheet" />
<div class="panel with-nav-tabs panel-default">
    <div class="panel-heading">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#normal" data-toggle="tab">Other Bank Normal Transaction</a></li>
            <li><a href="#bulk" data-toggle="tab">Other Bank Bulk Transaction</a></li>
        </ul>
    </div>
    <div class="panel-body">
        <div class="tab-content">
            <div class="tab-pane fade in active" id="normal">
                <h3>Other Bank Transaction (CCT)</h3>
                <br />
                @using (Html.BeginForm("ExportToExcel", "CCT", FormMethod.Post))
                {
            <div class="row">
                @*@if (!ViewContext.ViewData.ModelState.IsValid)
        {
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        }*@
                <div class="col-md-2">
                    CBM Tran Type
                    @Html.DropDownList("ddlCBMTranType", new SelectList(ViewBag.CBMTran_Type, "Value", "Text", ViewBag.CBMTran_Type), "Select CBM Tran Type", new { @class = "form-control" })
                </div>
                <div class="col-md-2">
                    Download Type
                    @Html.DropDownList("ddlDownloadType", new SelectList(ViewBag.DownloadType, "Value", "Text", ViewBag.DownloadType), null, new { @class = "form-control" })
                </div>
                <div class="form-group col-md-2">
                    From Date
                    <div class='input-group date' id='fromDate'>
                        @Html.TextBox("FromDate", DateTime.Now.ToString("dd-MM-yyyy"), new { @class = "form-control", placeholder = "From Date", autocomplete = "off", onkeydown = "event.preventDefault()" })
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
                <div class="form-group col-md-2">
                    To Date
                    <div class="input-group date" id='toDate'>
                        @Html.TextBox("ToDate", DateTime.Now.ToString("dd-MM-yyyy"), null, new { @class = "form-control", placeholder = "To Date", autocomplete = "off", onkeydown = "event.preventDefault()" })
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
                <div class="form-group col-md-1">
                    <br />
                    <input type="button" class="btn btn-default" id="btnSearch" value="Search" onclick="dateValidation()" />
                </div>
                <div class="form-group col-md-2">
                    <br />
                    <input type="submit" value="ExportToExcel" class="btn btn-success" />

                </div>
            </div>
                }
            <div class="table-responsive">
                <table class="table table-striped table-bordered nowrap" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>
                                Reconciliation Number
                            </th>
                            <th>
                                Fund Debtor FI Branch Code
                            </th>
                            <th>
                                Fund Creditor FI Branch Code
                            </th>
                            <th>
                                Total Fund Settlement Amount(MMK)
                            </th>
                            <th>
                                Transfer Amount(MMK)
                            </th>
                            <th>
                                Interbank Charge Amount (MMK) to Debtor FI
                            </th>
                            <th>
                                Interbank Charge Amount (MMK) to Creditor FI
                            </th>
                            <th>
                                Download Type
                            </th>
                            @*<th>
                        ValueDate
                    </th>*@
                        </tr>
                    </thead>
                    <tbody id="tdshow">
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                        <tr>
                            <td>20200916AB211</td>
                            <td>AYFDMMMYYGN</td>
                            <td>AYFDMMMYYGN</td>
                            <td>1000.00</td>
                            <td>1000.00</td>
                            <td>0.00</td>
                            <td>0.00</td>
                            <td>New</td>
                        </tr>
                </table>
                </tbody>

            </div>
            </div>
            <div class="tab-pane fade" id="bulk">
                <h3>Other Bank Bulk Transaction(CCT)</h3>
                <br />
                @*<input id="IsBulkFile" name="IsBulkFile" type="hidden" value="true" />*@
                @using (Html.BeginForm("BulkPaymentExportToExcel", "CCT", FormMethod.Post))
                {
            <div class="row">
                <div class="col-md-2">
                    Company Name
                    @Html.TextBox("txtCompanyName", (string)ViewBag.aCompany, new { @class = "form-control" })
                </div>
                <div class="col-md-2">
                    Bulk File Name
                    @Html.TextBox("txtBulkFileName", (string)ViewBag.aCompany, new { @class = "form-control" })
                </div>
                <div class="col-md-2">
                    CBM Tran Type
                    @Html.DropDownList("ddlBulkCBMTranType", new SelectList(ViewBag.CBMTran_Type, "Value", "Text", ViewBag.CBMTran_Type), "Select CBM Tran Type", new { @class = "form-control" })
                </div>
                <div class="col-md-2">
                    Download Type
                    @Html.DropDownList("ddlBulkDownloadType", new SelectList(ViewBag.DownloadType, "Value", "Text", ViewBag.DownloadType), null, new { @class = "form-control" })
                </div>
                <div class="form-group col-md-2">
                    From Date
                    <div class='input-group date' id='fromDate'>
                        @Html.TextBox("BulkFromDate", DateTime.Now.ToString("dd-MM-yyyy"), new { @class = "form-control", placeholder = "From Date", autocomplete = "off", onkeydown = "event.preventDefault()" })
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
                <div class="form-group col-md-2">
                    To Date
                    <div class="input-group date" id='toDate'>
                        @Html.TextBox("BulkToDate", DateTime.Now.ToString("dd-MM-yyyy"), null, new { @class = "form-control", placeholder = "To Date", autocomplete = "off", onkeydown = "event.preventDefault()" })
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>
                    <br />
                    <div class="row">
                        <div class="col-md-1">
                            <input type="button" class="btn btn-default" id="btnBulkSearch" value="Search" onclick="dateValidation()" />
                        </div>
                        <div class="col-md-2">
                            <input type="submit" value="ExportToExcel" class="btn btn-success" />
                        </div>
                    </div>
                }
                <br />
                <div class="table-responsive">
                    <table id="myTable2" class="table table-striped table-bordered nowrap" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>
                                    Company Name
                                </th>
                                <th>
                                    Bulk File Name
                                </th>
                                <th>
                                    Reconciliation Number
                                </th>
                                <th>
                                    Fund Debtor FI Branch Code
                                </th>
                                <th>
                                    Fund Creditor FI Branch Code
                                </th>
                                <th>
                                    Total Fund Settlement Amount(MMK)
                                </th>
                                <th>
                                    Transfer Amount(MMK)
                                </th>
                                <th>
                                    Interbank Charge Amount (MMK) to Debtor FI
                                </th>
                                <th>
                                    Interbank Charge Amount (MMK) to Creditor FI
                                </th>
                                <th>
                                    Download Type
                                </th>
                                @*<th>
                            ValueDate
                        </th>*@
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-danger" id="divError">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title">User List</h4>
            </div>
            <div class="modal-body">
                <p id="errMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline pull-left" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div class="modal modal-danger" id="divDateValidate">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title">Date Validation Error</h4>
            </div>
            <div class="modal-body">
                <p id="errorMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline pull-left" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

@section Scripts{
    @Scripts.Render("~/bundles/otherbanktranlog")
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/bootstrap-datepicker.min.js"></script>
    <script>
        $('document').ready(function () {
            $('#tdshow').hide();
        })
        $('#btnSearch').click(function () {
            $('#tdshow').show();
        });
        $(function () {

            /*disable datatable warnings*/
            $.fn.dataTable.ext.errMode = 'none';

            $("#fromDate,#toDate").datetimepicker({
                format: 'DD-MM-YYYY'
            });

            $("#myTable").dataTable(
                {
                    //"stateSave": true, // to save current state when going to next page
                    //"processing": true, // for show processing bar
                    "serverSide": true, // for process on server side
                    "orderMulti": false, // for disable multi column order
                    "dom": '<"top"i>rt<"bottom"lp><"clear">', // for hide default global search box // little confusion? don't worry I explained in the tutorial website
                    "ajax": {
                        "url": "/CCT/OtherBankRecon",
                        "type": "POST",
                        "datatype": "json"
                    },
                    "columns": [                      
                        { "data": "RECON_NUMBER", "name": "RECON_NUMBER", "autoWidth": true },
                        { "data": "DR_BR_CODE", "name": "DR_BR_CODE", "autoWidth": true },
                        { "data": "CR_BR_CODE", "name": "CR_BR_CODE", "autoWidth": true },
                        { "data": "TOTAL_SETTLEMENT_AMT", "name": "TOTAL_SETTLEMENT_AMT", "autoWidth": true },
                        { "data": "TRAN_AMT", "name": "TRAN_AMT", "autoWidth": true },
                        { "data": "DR_INTERBANK_CHARGE_AMT", "name": "DR_INTERBANK_CHARGE_AMT", "autoWidth": true },
                        { "data": "CR_INTERBANK_CHARGE_AMT", "name": "CR_INTERBANK_CHARGE_AMT", "autoWidth": true },
                        {
                            "data": "IsDownloaded", "name": "IsDownloaded", "autoWidth": true,
                            render: function (data) {
                                if (data == '0') {
                                    var data = "New";
                                    return data;
                                }
                                else if (data == '1') {
                                    var data = "Downloaded";
                                    return data;
                                }

                            }
                        }
                        //,{
                        //    "data": "VALUE_DATE", "name": "VALUE_DATE", "autoWidth": true
                        //    render: function (data, type, row) {
                        //        var date = new Date(parseInt(data.substr(6)));
                        //        return date.toLocaleDateString('es-CL');
                        //    }
                        //}
                    ]
                });

            oTable = $('#myTable').DataTable();
            $('#btnSearch').click(function () {
                //Apply search for Employee Name // DataTable column index 0
                oTable.columns(1).search($('#FromDate').val().trim());
                oTable.columns(2).search($('#ToDate').val().trim());
                oTable.columns(3).search($('#ddlDownloadType').val().trim());
                oTable.columns(4).search($('#ddlCBMTranType').val().trim());
                //hit search on server
                oTable.draw();
            });
            oTable.columns(3).search($('#ddlDownloadType').val().trim());
            oTable.draw();

            //For Bulk Transaction
            $("#fromDate,#toDate").datetimepicker({
                format: 'DD-MM-YYYY'
            });

            $("#myTable2").dataTable(
                {
                    //"stateSave": true, // to save current state when going to next page
                    //"processing": true, // for show processing bar
                    "serverSide": true, // for process on server side
                    "orderMulti": false, // for disable multi column order
                    "dom": '<"top"i>rt<"bottom"lp><"clear">', // for hide default global search box // little confusion? don't worry I explained in the tutorial website
                    "ajax": {
                        "url": "/CCT/BulkPaymentRecon",
                        "type": "POST",
                        "datatype": "json"
                    },
                    "columns": [
                        { "data": "CompanyName", "name": "CompanyName", "autoWidth": true },
                        { "data": "FileName", "name": "FileName", "autoWidth": true },
                        { "data": "RECON_NUMBER", "name": "RECON_NUMBER", "autoWidth": true },
                        { "data": "DR_BR_CODE", "name": "DR_BR_CODE", "autoWidth": true },
                        { "data": "CR_BR_CODE", "name": "CR_BR_CODE", "autoWidth": true },
                        { "data": "TOTAL_SETTLEMENT_AMT", "name": "TOTAL_SETTLEMENT_AMT", "autoWidth": true },
                        { "data": "TRAN_AMT", "name": "TRAN_AMT", "autoWidth": true },
                        { "data": "DR_INTERBANK_CHARGE_AMT", "name": "DR_INTERBANK_CHARGE_AMT", "autoWidth": true },
                        { "data": "CR_INTERBANK_CHARGE_AMT", "name": "CR_INTERBANK_CHARGE_AMT", "autoWidth": true },
                        {
                            "data": "IsDownloaded", "name": "IsDownloaded", "autoWidth": true,
                            render: function (data) {
                                if (data == '0') {
                                    var data = "New";
                                    return data;
                                }
                                else if (data == '1') {
                                    var data = "Downloaded";
                                    return data;
                                }

                            }
                        }
                    ]
                });

            oBulkTable = $('#myTable2').DataTable();
            $('#btnBulkSearch').click(function () {
                //Apply search for Employee Name // DataTable column index 0
                oBulkTable.columns(1).search($('#txtCompanyName').val().trim());
                oBulkTable.columns(2).search($('#txtBulkFileName').val().trim());
                oBulkTable.columns(3).search($('#BulkFromDate').val().trim());
                oBulkTable.columns(4).search($('#BulkToDate').val().trim());
                oBulkTable.columns(5).search($('#ddlBulkDownloadType').val());
                oBulkTable.columns(6).search($('#ddlBulkCBMTranType').val());
                //hit search on server
                oBulkTable.draw();
            });
            oBulkTable.columns(5).search($('#ddlBulkDownloadType').val());
            oBulkTable.draw();

        })
    </script>
    @if (@ViewBag.filename != null && ViewBag.filename != "")
    {
        <script>
             var file_path = "/CCT/Download?filename=" + '@ViewBag.filename';
                var a = document.createElement('A');
                a.href = file_path;
                a.download = file_path.substr(file_path.lastIndexOf('/') + 1);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
        </script>
    }
    @if (@ViewBag.IsBulkFile != null && @ViewBag.IsBulkFile == "true")
    {
        <script>
            $('.nav-tabs a[href="#bulk"]').tab('show');
        </script>
    }
}


